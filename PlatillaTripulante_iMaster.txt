/*
 * Pueda usar esta plantilla para la carga del reto a iMaster
 * Copie las clases de los paquetes Modelo, Vista, Controlador y Util
 * No incluya los import de los archivos .java solo las clases
 */
// Importaciones necesarias en iMaster
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.PreparedStatement;
import java.util.ArrayList;

// Util (No modificar)
class JDBCUtilities {
    private static final String DATABASE_LOCATION = "ProyectosConstruccion.db";

    public static Connection getConnection() throws SQLException {
        String url = "jdbc:sqlite:"+DATABASE_LOCATION;

        return DriverManager.getConnection(url);
    }
}

// Remplace en adelante por las clases de sus archivos .java

// Vista

public class VistaRequerimientosReto4 {
    
    public static final ControladorRequerimientosReto4 controlador = new ControladorRequerimientosReto4();

    public static void requerimiento1(){
    
        System.out.println("*** Proyectos por Estrato ***");
        
        try{
            ArrayList<ProyectosPorEstrato> rankingProyectosPorEstratos = controlador.requerimiento1();

            for (ProyectosPorEstrato proyectosPorEstrato: rankingProyectosPorEstratos){
                System.out.printf("El proyecto de ID_Tipo %d de codigo: %d de Area Maxima %d, tiene un estrato %d %n",
                    proyectosPorEstrato.getIdTipo(),
                    proyectosPorEstrato.getCodigoTipo(),
                    proyectosPorEstrato.getAreaMaxima(),
                    proyectosPorEstrato.getEstrato()
                );
            }

        }catch(SQLException e){
            System.err.println("Ha ocurrido un error!"+e.getMessage());
        }
    }

    public static void requerimiento2(){     

        System.out.println("*** Proyectos por Tipo ***");

        try{
            
            ArrayList<ProyectosPorTipo> rankingProyectosPorTipo = controlador.requerimiento2();

            for (ProyectosPorTipo proyectosPorTipo: rankingProyectosPorTipo){
                System.out.printf("El proyecto de ID_Proyecto %d de la constructora: %s de la ciudad %s, tiene un estrato asignado de %d %n",
                    proyectosPorTipo.getIdProyecto(),
                    proyectosPorTipo.getConstructora(),
                    proyectosPorTipo.getCiudad(),
                    proyectosPorTipo.getEstrato()
                );
            }

        }catch(SQLException e){
            System.err.println(e);
        }
    }

    public static void requerimiento3(){

        System.out.println("*** Proyectos de Tipo Apartaestudio en Quibdo ***");

        try{
              // su codigo
            ArrayList<ProyectosQuibdoApartaestudio> rankingProyectosQuibdoApartaestudios = controlador.requerimiento3();

            for (ProyectosQuibdoApartaestudio proyectosQuibdoApartaestudio: rankingProyectosQuibdoApartaestudios){
                System.out.printf("El proyecto de ID_Proyecto %d de la constructora: %s tiene un porcentaje de cuota inicial de %.1f, y %s tiene acabados %n",
                    proyectosQuibdoApartaestudio.getIdProyecto(),
                    proyectosQuibdoApartaestudio.getConstructora(),
                    proyectosQuibdoApartaestudio.getPorcentajeCuotaInicial(),
                    proyectosQuibdoApartaestudio.getAcabados()
                );
            }    
        
        }catch(SQLException e){
            System.err.println(e);
        }
    }

}

// Controlador

public class ControladorRequerimientosReto4 { 
    //Su codigo
    private final ProyectosPorEstratoDao proyectosPorEstratoDao;
    private final ProyectosPorTipoDao proyectosPorTipoDao;
    private final ProyectosQuibdoApartaestudioDao proyectosQuibdoApartaestudioDao;
    
    public ControladorRequerimientosReto4(){
        //Su codigo
        this.proyectosPorEstratoDao = new ProyectosPorEstratoDao();
        this.proyectosPorTipoDao = new ProyectosPorTipoDao();
        this.proyectosQuibdoApartaestudioDao = new ProyectosQuibdoApartaestudioDao();
    }

    public ArrayList<ProyectosPorEstrato> requerimiento1() throws SQLException {
        //Su codigo
        return this.proyectosPorEstratoDao.rankingProyectosPorEstrato();
    }
    
    public ArrayList<ProyectosPorTipo> requerimiento2() throws SQLException {
        //Su codigo
        return this.proyectosPorTipoDao.rankingProyectosPorTipo();
    }

    public ArrayList<ProyectosQuibdoApartaestudio> requerimiento3() throws SQLException {
        //Su codigo
        return this.proyectosQuibdoApartaestudioDao.rankingProyectosQuibdoApartaestudios();
    }

}

// Modelo
// VO


public class ProyectosPorEstrato {
    //Su codigo
    private Integer idTipo;
    private Integer codigoTipo;
    private Integer areaMaxima;
    private Integer estrato;

    public ProyectosPorEstrato(){

    }

    public ProyectosPorEstrato(Integer idTipo, Integer codigoTipo, Integer areaMaxima, Integer estrato){
        this.idTipo = idTipo;
        this.codigoTipo = codigoTipo;
        this.areaMaxima = areaMaxima;
        this.estrato = estrato;
    }

    public Integer getIdTipo(){
        return this.idTipo;
    }
    public void setIdTipo(Integer idTipo){
        this.idTipo = idTipo;
    }

    public Integer getCodigoTipo(){
        return this.codigoTipo;
    }
    public void setCodigoTipo(Integer codigoTipo){
        this.codigoTipo = codigoTipo;
    }

    public Integer getAreaMaxima(){
        return this.areaMaxima;
    }
    public void setAreaMaxima(Integer areaMaxima){
        this.areaMaxima = areaMaxima;
    }

    public Integer getEstrato(){
        return this.estrato;
    }
    public void setEstrato(Integer estrato){
        this.estrato = estrato;
    }
}

public class ProyectosPorTipo {
    private Integer idProyecto;
    private String constructora;
    private String ciudad;
    private Integer estrato;

    public ProyectosPorTipo() {
    }

    public ProyectosPorTipo(Integer idProyecto, String constructora, String ciudad, Integer estrato) {
        this.idProyecto = idProyecto;
        this.constructora = constructora;
        this.ciudad = ciudad;
        this.estrato = estrato;
    }

    
    public Integer getIdProyecto() {
        return idProyecto;
    }

    public void setIdProyecto(Integer idProyecto) {
        this.idProyecto = idProyecto;
    }

    public String getConstructora() {
        return constructora;
    }

    public void setConstructora(String constructora) {
        this.constructora = constructora;
    }

    public String getCiudad() {
        return ciudad;
    }

    public void setCiudad(String ciudad) {
        this.ciudad = ciudad;
    }

    public Integer getEstrato() {
        return estrato;
    }

    public void setEstrato(Integer estrato) {
        this.estrato = estrato;
    }
    
}

public class ProyectosQuibdoApartaestudio {
    //su codigo
    private Integer idProyecto;
    private String constructora;
    private Float porcentajeCuotaInicial;
    private String acabados;

    public ProyectosQuibdoApartaestudio() {
    }

    public ProyectosQuibdoApartaestudio(Integer idProyecto, String constructora, Float porcentajeCuotaInicial, String acabados) {
        this.idProyecto = idProyecto;
        this.constructora = constructora;
        this.porcentajeCuotaInicial = porcentajeCuotaInicial;
        this.acabados = acabados;
    }

    
    public Integer getIdProyecto() {
        return idProyecto;
    }

    public void setIdProyecto(Integer idProyecto) {
        this.idProyecto = idProyecto;
    }

    public String getConstructora() {
        return constructora;
    }

    public void setConstructora(String constructora) {
        this.constructora = constructora;
    }

    public Float getPorcentajeCuotaInicial() {
        return porcentajeCuotaInicial;
    }

    public void setPorcentajeCuotaInicial(Float porcentajeCuotaInicial) {
        this.porcentajeCuotaInicial = porcentajeCuotaInicial;
    }

    public String getAcabados() {
        return acabados;
    }

    public void setAcabados(String acabados) {
        this.acabados = acabados;
    } 
}

// DAO

public class ProyectosPorEstratoDao {
    //Obtener los proyectos por Estrato 5 o 6
    public ArrayList<ProyectosPorEstrato> rankingProyectosPorEstrato() throws SQLException {

        ArrayList<ProyectosPorEstrato> respuesta = new ArrayList<ProyectosPorEstrato>();
        Connection conexion = JDBCUtilities.getConnection();

        try{       

            String consulta =   "SELECT Id_Tipo, Codigo_Tipo, Area_Max, Estrato "+
                                "FROM Tipo "+
                                "WHERE Estrato = 5 OR Estrato = 6 "+
                                "ORDER BY Estrato ";


            PreparedStatement statement = conexion.prepareStatement(consulta);
            ResultSet resultSet = statement.executeQuery();

            //Recorrer los registros en los VO específicos
            while(resultSet.next()){
                ProyectosPorEstrato proyectosPorEstrato = new ProyectosPorEstrato();
                proyectosPorEstrato.setIdTipo(resultSet.getInt("Id_Tipo"));
                proyectosPorEstrato.setCodigoTipo(resultSet.getInt("Codigo_Tipo"));
                proyectosPorEstrato.setAreaMaxima(resultSet.getInt("Area_Max"));
                proyectosPorEstrato.setEstrato(resultSet.getInt("Estrato"));

                //Se agrega cada registro como un objeto del ArrayList que contiene la consulta
                respuesta.add(proyectosPorEstrato);
            }

            resultSet.close();
            statement.close();

        }catch(SQLException e){
            System.err.println("Error consultando los proyectos por estrato: "+e);
        }finally{
            if(conexion != null){
                conexion.close();
            }
        }

        //Retornar la colección de vo's
        return respuesta;
    }  
}

public class ProyectosPorTipoDao {
   
    public ArrayList<ProyectosPorTipo> rankingProyectosPorTipo() throws SQLException {
        //su codigo
        ArrayList<ProyectosPorTipo> respuesta = new ArrayList<ProyectosPorTipo>();
        Connection conexion = JDBCUtilities.getConnection();

        try{       

            String consulta =   "select ID_Proyecto, Constructora, Ciudad, Estrato "+
                                "from Proyecto p "+
                                "join Tipo t on p.ID_Tipo = t.ID_Tipo "+
                                "where Ciudad = 'Monteria' ";


            PreparedStatement statement = conexion.prepareStatement(consulta);
            ResultSet resultSet = statement.executeQuery();

            //Recorrer los registros en los VO específicos
            while(resultSet.next()){
                ProyectosPorTipo proyectosPorTipo = new ProyectosPorTipo();
                proyectosPorTipo.setIdProyecto(resultSet.getInt("ID_Proyecto"));
                proyectosPorTipo.setConstructora(resultSet.getString("Constructora"));
                proyectosPorTipo.setCiudad(resultSet.getString("Ciudad"));
                proyectosPorTipo.setEstrato(resultSet.getInt("Estrato"));

                //Se agrega cada registro como un objeto del ArrayList que contiene la consulta
                respuesta.add(proyectosPorTipo);
            }

            resultSet.close();
            statement.close();

        }catch(SQLException e){
            System.err.println("Error consultando los proyectos por estrato: "+e);
        }finally{
            if(conexion != null){
                conexion.close();
            }
        }

        //Retornar la colección de vo's
        return respuesta;
    }
        
}

public class ProyectosQuibdoApartaestudioDao {
   
    public ArrayList<ProyectosQuibdoApartaestudio> rankingProyectosQuibdoApartaestudios() throws SQLException {
        //su codigo
        ArrayList<ProyectosQuibdoApartaestudio> respuesta = new ArrayList<ProyectosQuibdoApartaestudio>();
        Connection conexion = JDBCUtilities.getConnection();

        try{       

            String consulta =   "select ID_Proyecto, Constructora, Porcentaje_Cuota_Inicial, Acabados "+
                                "from Proyecto p "+
                                "where Clasificacion = 'Apartaestudio' and Ciudad = 'Quibdo' ";


            PreparedStatement statement = conexion.prepareStatement(consulta);
            ResultSet resultSet = statement.executeQuery();

            //Recorrer los registros en los VO específicos
            while(resultSet.next()){
                ProyectosQuibdoApartaestudio proyectosPorQuibdoApartaestudio = new ProyectosQuibdoApartaestudio();
                proyectosPorQuibdoApartaestudio.setIdProyecto(resultSet.getInt("ID_Proyecto"));
                proyectosPorQuibdoApartaestudio.setConstructora(resultSet.getString("Constructora"));
                proyectosPorQuibdoApartaestudio.setPorcentajeCuotaInicial(resultSet.getFloat("Porcentaje_Cuota_Inicial"));
                proyectosPorQuibdoApartaestudio.setAcabados(resultSet.getString("Acabados"));

                //Se agrega cada registro como un objeto del ArrayList que contiene la consulta
                respuesta.add(proyectosPorQuibdoApartaestudio);
            }

            resultSet.close();
            statement.close();

        }catch(SQLException e){
            System.err.println("Error consultando los proyectos por estrato: "+e);
        }finally{
            if(conexion != null){
                conexion.close();
            }
        }

        //Retornar la colección de vo's
        return respuesta;

    }
        
}